## 1.	Выбор средств разработки

Для реализации многомерных кубов данных, помимо создания БД с особой архитектурой, необходимо использование OLAP-сервера. В серверных OLAP-средствах вычисления и хранение агрегатных данных выполняются на сервере, в то время как клиентское приложение получает только результаты запросов к многомерным кубам, которые хранятся на сервере, например, для дальнейшей их визуализации. Некоторые OLAP-серверы поддерживают хранение данных только в реляционных базах, некоторые - только в многомерных. Многие современные OLAP-серверы поддерживают все три способа хранения данных: MOLAP, ROLAP и HOLAP. 

В связи с тем, что кафедра ФВиС является сторонником открытого ПО, необходимо полностью бесплатное и открытое решение, поэтому далее рассматриваться будут только open-source решения.

### 1.1 Knowage

Knowage - это пакет для бизнес-аналитики с открытым исходным кодом, который объединяет традиционные данные и bigdata источники в ценную и содержательную информацию. Помимо коммерческой лицензии имеется также community версия с полным набором аналитических возможностей.

Knowage представляет из себя веб-приложение, написанное на Java (J2EE) с различными правами доступа. Имеется OLAP движок с поддержкой стандартных операций (свертки, детализирования, срезов), возможность строить различные графики с сохранением. Поддержка вычисляемых полей, временных рядов имеется только в коммерческой версии. Помимо работы с многомерными данными предоставляется еще обширный функционал, который не требуется в данной работе и может вызвать сложность для понимания пользователем. 

Пакет предоставляется на английском языке, при этом большая часть работы пользователя связана с перемещением по интерфейсу, что также приводит к усложнению понимания. Не имеет поддержки встраивания в другое веб-приложение.

### 1.2 PentahoBI + Saiku

PentahoBISuite (PentahoBusinessIntelligenceSuite) – свободное ПО для бизнес-анализа на программной платформе Java, разрабатываемое компанией Pentaho. В состав Pentaho входит OLAP-сервер Mondrian, который поддерживает все операции OLAP. Pentaho позволяет преобразовать схему Mondrian (описание схемы куба в формате XML) в многомерный куб. Компания Pentaho предоставляет также дополнительные инструменты для преобразования таблицы фактов в схему «звезда» и, далее, в схему Mondrian.

Для работы с построенными кубами предоставляется дополнительный плагин Saiku Analytics. Saiku предоставляет множество инструментов для построения запросов, графиков, таблиц, выполнения OLAP-операций. Имеет английский интерфейс, хотя и довольно понятный в целом (имеется много иконок вместо надписей, что позволяет понять назначение элементов). Поддержку встраивания в другое веб-приложение имеет только коммерческое решение со своим собственным сервером.

### 1.3 Cubes + CubesViewer

Cubes – полностью открытый, легковесный фреймворк для Python и набор инструментов для OLAP, многомерного анализа и просмотра агрегированных данных. Входит в состав DataBrewery – набора Python фреймворков и инструментов для обработки и анализа данных.

Cubes по умолчанию использует технологию ROLAP, поддерживает все основные операции OLAP, включая арифметические операции над мерами и временные ряды. Сервер работает по протоколу HTTP.

В качестве клиента предоставляется веб-инструмент CubesViewer, который может использоваться для выполнения операций над кубами, построения различных графиков и фильтрации данных. CubesViewer имеет также англоязычный интерфейс, хотя большинство действий иллюстрированы иконками. 

CubesViewer предоставляет возможность полного встраивания в другие веб-приложения, при этом позволяет разместить на одной странице несколько представлений (графическое представление куба с интерфейсом для выполнения операций), что может быть полезно, если нет желания переключатся между разными экранами/страницами.

### 1.4 Критерии сравнения

Для того, чтобы выбрать подходящие инструменты, были выделены следующие критерии сравнения:

* _Поддержка ROLAP._ В связи с выбранным способом реализации многомерных кубов необходимо, чтобы OLAP-сервер поддерживал возможность работать с данными, хранящимися в реляционном виде;
* _Наличие удобного пользовательского интерфейса._ У пользователя не должно возникать затруднений при работе с многомерными данными, при этом выполнение операций не должно состоять из большого количества действий;
* _Поддержка OLAP-операций._ OLAP-сервер должен поддерживать следующие операции: свертка/детализация, вращение, срезы по измерениям, поддержка иерархий, арифметические операции над мерами, фильтрация данных.
* _Возможность встраивания в АИС кафедры ФВиС._ Одним из требований к системе работы с архивной информации является именно возможность встраивания, т.е. система не должна быть отдельным приложением.
* _Простота использования в разработке._ Оценивается простота установки и настройки сервера, простота формирования моделей кубов из реляционных данных и простота настройки пользовательского интерфейса.

### 1.5 Результаты сравнения

Результаты сравнения по выделенным в разделе 1.4 критериям приведены в таблице 1.1. Использовалась градация оценок от 0 (полное отсутствие выполнения критерия) до 5 (критерий полностью выполняется).

Таблица 1.1 – сравнение средств разработки

![](https://github.com/KrenAnastasiya/NIR/blob/master/img/%D1%82%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D0%B0%20%D1%81%D1%80%D0%B0%D0%B2%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F.PNG)

По результатам анализа был выбран союз Cubes + CubesViewer, т.к. по сумме критериев он набрал максимальную оценку.

## 2 Описание выбранных средств разработки

### 2.1 Cubes

Цель данного фреймворка – предоставить аналитику или любому другому конечному пользователю понятный и естественный способ отчетности, используя концепцию кубов – многомерных объектов данных.

Cubes обладает следующими особенностями:

* логическое представление данных – как видят данные аналитики, а не как они хранятся физически;
* OLAP и агрегированный просмотр (используется ROLAP);
* иерархические измерения (атрибуты, которые имеют иерархические зависимости, такие как категория-подкатегория, страна-регион);
* наличие множества иерархий в измерении;
* локализуемые метаданные и данные;
* аутентификация и авторизация кубов и их данных;
* подключаемые хранилища данных – подключение других, похожих на кубы (многомерных) источников данных.

Для реализации поставленной задачи будут использоваться все перечисленные свойства, за исключением аутентификации.

Cubes разделяют на следующие части:

* Workspace (рабочее пространство) – аналитическое рабочее пространство, которое управляет кубами, публичными измерениями, хранилищами данных (stores), провайдерами модели (modelproviders) и метаданными модели, а также предоставляет обозреватели агрегаций и обслуживает соединения с базами данных. Хранилище данных представляет собой источник данных, например, таблицу в БД. Провайдер модели создает модели кубов, измерения и другие аналитические объекты;
* Model (модель) – представляет собой описание данных (метаданные): кубы, измерения, иерархии, атрибуты, метки, локализацию;
* Browser (обозреватель) – просмотр агрегаций, slicing-and-dicing, drill-down;
* Backend (серверная часть) – реализация агрегаций и вспомогательные функции. Cubes использует встроенную ROLAP серверную часть, которая использует БД SQL с помощью SQLAlchemy (набор SQL и ORM (Object-RelationalMapping, объектно-реляционное отображение) инструментов для Python);
* Server (сервер) - WSGI HTTP сервер для Cubes. WSGI (WebServerGatewayInterface) – стандарт взаимодействия между Python-программой, выполняющейся на стороне сервера, и веб-сервером. Сервер предоставляет jsonAPI для большей части функционала фреймворка;
* Formatters (форматеры) – форматеры данных;
* slicer – CommandLineTool (инструмент командной строки) – облегчает управление сервером посредством ввода команд (например, таких команд, как запуск сервера, валидация моделей).

Чтобы Cubes мог работать с кубами, необходимо описать их модель. Логическая модель описывает данные с точки зрения анализа пользователя: как данные будут измерены, как агрегированы и как будут выводиться в отчет. Модель не зависит от физической реализации данных, что позволяет проще сфокусироваться на сути самих данных.

Логическая модель позволяет пользователям:

* видеть данные с точки зрения бизнеса;
* скрыть физическую структуру данных;
* указать иерархии атрибутов;
* предоставить более описательные названия атрибутов для отображения в приложении или отчетах;
* прозрачную локализацию метаданных и данных.

Логическая модель описывается с использованием словаря метаданных моделей. В ней содержится описание логических объектов, физического хранилища и другая дополнительная информация. Состав модели приведен на рисунке 1.

![](https://github.com/KrenAnastasiya/NIR/blob/master/img/%D0%9C%D0%BE%D0%B4%D0%B5%D0%BB%D1%8C.PNG)

Рис. 1 – Описание модели

Логическая часть описания модели состоит из:

* name – имя модели;
* label – удобное для восприятие человеком имя модели (необязательно);
* description – удобное для восприятие человеком описание модели (необязательно);
* locale – локаль, в которой написаны метаданные модели (необязательно, используется для локализируемых моделей);
* cubes – список метаданных кубов (рассматриваются ниже);
* dimensions – список метаданных измерений (рассматриваются ниже).

Физическая часть описания модели состоит из:

* store – имя хранилища данных, где хранятся кубы модели, по умолчанию default;
* mappings – словарь отображений логических наименований в физические, данный словарь наследуется всеми кубами в модели;
* joins – список словарей для спецификации операций JOIN;
* browser_options – опции, передающиеся в обозреватель.

Если в описании модели указаны mappings и/или joins, то они наследуются всеми кубами модели. Mappings объединяются таким образом, что mappings куба заменяются существующими mappings модели с тем же именем. Joins объединяются или сливаются по их имени.

Модель может быть представлена либо как файл в формате JSON, либо как каталог с файлами JSON. Спецификация модели в одном файле – это просто словарь со свойствами модели. Если модель описана в нескольких файлах, то каталог должен иметь следующее содержание:

* model.json – основные метаданные модели (то же, что и однофайловая модель);
* dim_*.json – файл с метаданными измерения (словарь одного измерения);
* cube_*.json – метаданные куба (словарь одного куба).

Описание кубов хранится в словаре с ключом cubes в словаре описания модели или в файлах JSON с префиксом cube_.

Описание куба состоит из:

* базовых элементов:
* * name * – имя куба, уникальный идентификатор;
* * label – удобное для восприятия человеком имя куба (используется для отображения в приложении);
* * description – удобное для восприятия человеком описание куба;
* * info – пользовательская информация, например, форматирование. Не используется фреймворком Cubes;
* * dimensions * – список имен измерений или ссылок на измерения;  
* * measures – список мер куба;
* * aggregates – список агрегируемых мер;
* * details – список деталей фактов – атрибуты, которые не относятся к агрегации, но полезны при отображении фактов;
* физических:
* * joins – спецификация физических соединений таблицы;
* * mappings – отображение логических атрибутов в физические;
* * key – имя столбца с ключом в таблице фактов (по умолчанию id);
* * fact – имя таблицы фактов, если не указано, то используется имя куба;
* продвинутых:
* * browser_options – специфичные опции обозревателя;
* * store – имя хранилища, в котором хранится куб.

Поля, отмеченные звездочкой, обязательны.

Меры, которые являются числовыми характеристиками факта, агрегируются в агрегаты меры, пример расчета агрегата путем суммирования представлен на рисунке 2.

![](https://github.com/KrenAnastasiya/NIR/blob/master/img/%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80.PNG)

Рисунок 2 – Пример агрегата меры quantity (количество)

Меры описываются с помощью следующих элементов:

* name * – идентификатор меры;
* label – удобное для восприятия человеком имя;
* info – дополнительная пользовательская информация;
* aggregates – список агрегирующих функций, которые будут использоваться для данной меры. Это свойство используется для автоматической генерации агрегатов, однако рекомендуется описывать агрегаты явно;
* window_size – количество элементов в окне для оконных функций, таких как скользящее среднее (по умолчанию 1).

Агрегаты мер описываются с помощью:

* name – идентификатор агрегата (например, quantity_sum);
* label – удобное для восприятия человеком имя;
* measure – мера, для которой производятся вычисления (может быть пустым);
* function – имя агрегирующей функции, которая будет применяться к мере (например, sum, min, max). Функции не обязательно должны применяться к мере, есть функции, для которых не нужно указание меры, например, подсчет количества строк (count);
* window_size – количество элементов в окне для оконных функций;
* info – дополнительная пользовательская информация.

Описание измерений хранится в словаре модели под ключом dimensions. Описание каждого измерения содержит следующие поля:
* базовые:
* * name * – имя измерения (уникальный идентификатор);
* * label – удобное для восприятия человеком имя;
* * description – удобное для восприятия человеком описание измерения;
* * info – пользовательская информация;
* * levels – список описаний уровней;
* * hierarchies – список иерархий измерения;
* * default_hierarchy_name – имя иерархии, используемой по умолчанию;
* продвинутые:
* * cardinality – мощность измерения;
* * role – роль измерения;
* * category – логическая категория;
* * template – имя измерения, которое будет использоваться в качестве шаблона.

При использовании нескольких измерений с одинаковой или похожей структурой Cubes позволяет определить шаблон измерения, который затем может использоваться в качестве основы для других измерений.

Уровни иерархии измерения описываются с использованием следующих полей:

* name * – имя уровня (уникальный идентификатор);
* label – удобное для восприятия человеком имя;
* attributes – список других дополнительных атрибутов, которые относятся к уровню;
* key – ключевое поле уровня (например, имя месяца для уровня «месяц»);
* label_attribute – имя атрибута, содержащего надпись, которая будет отображена;
* order_attribute – имя атрибута, который будет использоваться для сортировки;
* cardinality – символическое приближение количества членов уровня;
* role – роль уровня;
* info – пользовательская информация.

Чтобы описать иерархию измерения используются следующие поля:

* name * – имя иерархии (уникальный идентификатор);
* label – удобное для восприятия человеком имя;
* levels – упорядоченный список имен уровней от наименее детализированного до наиболее детализированного (например, от года до дня).

### 2.2 CubesViewer

CubesViewer – это визуальное, отзывчивое (легко подстраиваемое под разные размеры, «резиновое») HTML5 приложение и библиотека для исследования и визуализации разных типов наборов данных. CubesViewer может использоваться для исследования и аудита данных, генерации отчетов, проектирования и встраивания диаграмм, а также в качестве простого приложения для аналитики всей компании.

Особенности CubesViewer:
* OLAP обозреватель – возможность исследовать данные по измерениям, фильтровать и применять drill-down, чтобы обнаружить новые факты и тренды.
* Диаграммы – доступен ряд опций визуализации данных, есть возможность переключаться между представлениями просто с помощью клика.
* Ряды – возможность определять и использовать ряды данных для обнаружения и выделения функций.
* Экспорт данных и диаграмм.
* Отзывчивый интерфейс.
* Операции отмены, повторения и клонирования – CubesViewer позволяет легко пробовать разные вариации представлений.
* Встраивание представлений – представления могут быть легко встроены в другие веб-сайты.
* CubesViewer Server – опциональная многопользовательская серверная часть для хранения и совместного просмотра представлений. 

## 3 Архитектура приложения

Система АИС ФВиС разрабатывалась с использованием CMS Wordpress . Wordpress написан на языке PHP и использует в качестве хранилища данных реляционную БД. Но после эксплуатации системы было решено переписать данную систему на framevork Laravel. Сравнительная таблица CMS Wordpress и framework Laravel представлена в описании предметной области. 

Подсистема для работы с архивной информацией будет разрабатываться в виде модуля archive. Архитектура приложения приведена на рисунке 3.

![](https://github.com/KrenAnastasiya/NIR/blob/master/img/4.png)

Рисунок 3 – Архитектура АИС ФВиС

## Описание реализация архивных БД

При разработке БД будет использоваться инструмент PhpMyAdmin, представляющий из себя веб-приложение и позволяющий осуществлять администрирование сервера БД через браузер, выполнять SQL запросы и просматривать содержимое и структуру таблиц и баз данных.

Две базы данных: fvis_archive – архивная БД для просмотра по годам, и fvisdb_cubes – архивная БД для многомерного анализа. В качестве первичного ключа в таблицах использовались числовые генерируемые СУБД идентификаторы. 

###  Описание реализации архивной БД для просмотра по годам

Для реализации данной БД будет написан скрипт, который будет создавать таблицы системы в исходной БД. Этот скрипт будет модифицирован путем добавления в таблицы полей year (год) и fvis_id (ID в исходной БД). Также удаляться внешние ключи, т.к. в архивную БД новые данные добавляться не будут (только во время сброса данных в архив), также архивные данные не будут удаляться и изменяться, т.е. не будет требоваться сохранения ссылочной целостности. К тому же, при переносе данных в архив с внешними ключами требуются дополнительные трудозатраты: нужно вставлять данные в определенном порядке, а вставлять записи в таблицы, которые зависят друг от друга (например, у студента есть группа, а у группы есть факультет), придется в несколько «заходов».

